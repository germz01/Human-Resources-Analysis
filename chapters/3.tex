Per definire le association rules prima si sono seguite le seguenti operazioni:
\begin{itemize}
\item Abbiamo trasformato le variabili da stringhe a numeriche, per quanto riguarda gli attributi \textit{Salary}
e \textit{Department}.
\item Abbiamo raggruppato le variabili \textit{Last Evaluation}, \textit{Satisfaction Level} e
\textit{Average Montly Hours}, usando $3$ bins sia per la prima che per la seconda variabile, usando intervalli
specifici, e $2$ bins per la terza variabile, applicando anche in questo caso una suddivisione ad hoc.
\item Per rendere unici i risultati numerici, è stata aggiunta una stringa subito successiva al valore numerico
in modo da non renderlo ambiguo e sopratutto in modo da poter capire univocamente a che attributo si riferisca.
\end{itemize}
\todo[inline]{Aggiungere la divisione in intervalli scelta e legenda con le abbreviazioni, oppure sotto non abbreviare}
\section{Frequent patterns extraction with different values of support and different types} % (fold)
\label{sec:frequent_patterns_extraction_with_different_values_of_support_and_different_types}
Dopo aver eseguito i passi preliminari descritti precedentemente abbiamo svolto l'analisi inerente ai
\textit{frequent patterns} attraverso l'applicazione dell'algoritmo \textit{Apriori}. Per ogni iterazione
dell'algoritmo, abbiamo considerato, indipendentemente dal \textit{support}, gli itemsets con $2$ o più items al
loro interno. Inoltre, al fine di avere una panoramica più completa, abbiamo svolto l'analisi per i
\textit{frequent itemsets}, per i \textit{closed frequent itemsets} e per i \textit{maximal frequent itemsets}.
Abbiamo quindi cominciato l'analisi con un support pari a $20$, ossia prendendo in considerazione soltanto gli
itemsets presenti in almeno il $20\%$ della transazioni. Successivamente abbiamo utilizzato un support pari a
$30$. Le quantità di frequent itemsets scoperte al variare dei paramentri sono riportate in Tabella
\ref{tab:freq_items}.
\begin{table}[H]
    \centering
    \resizebox{0.8\textwidth}{!}{
        \begin{tabular}{| c | c | c | c |}
            \hline
            \textbf{Support Threshold} & \textbf{Frequent Itemsets} & \textbf{Closed Frequent Itemsets} &
            \textbf{Maximal Frequent Itemsets} \\ \hline
            $20$ & $137$ & $130$ & $30$ \\ \hline
            $30$ & $46$ & $45$ & $11$ \\ \hline
        \end{tabular}
    }
    \caption{Quantità di frequent itemsets trovati per ogni tipologia e support utilizzati durante l'analisi.}
    \label{tab:freq_items}
\end{table}
Come era lecito aspettarsi, esiste un rapporto di proporzionalità inversa tra la soglia di support e il numero di
frequent itemsets scoperti.
% section frequent_patterns_extraction_with_different_values_of_support_and_different_types (end)
\section{Discussion of the most interesting frequent patterns} % (fold)
\label{sec:discussion_of_the_most_interesting_frequent_patterns}
Passiamo adesso alla descrizione dei frequent items più interessanti che sono stati scoperti durante l'analisi. In
Tabella \ref{tab:interesting:freq_items} vengono riportati gli itemsets più interessanti dal punto di vista del
supporto pari a $20$ scoperti durante l'analisi.
\begin{table}[H]
    \centering
    \resizebox{\textwidth}{!}{
        \begin{tabular}{| c | c | c | c | c | c |}
            \hline
            \textbf{Frequent Itemsets ($ST = 20$)} & \textbf{Support} &
            \textbf{Closed Frequent Itemsets ($ST = 20$)} & \textbf{Support} &
            \textbf{Maximal Frequent Itemsets ($ST = 20$)} & \textbf{Support}\\
            \hline
            (N\_WA, \ N\_P)  & $0.84$ & (N\_WA, \ N\_P)  & $0.84$ & (standard\_H, N\_L, N\_WA, N\_P) & $0.31$ \\
            \hline
            (N\_L, \ N\_P) & $0.74$ & (N\_L, \ N\_P) & $0.74$ & (intensive\_H, N\_L, N\_WA, N\_P) & $0.30$ \\
            \hline
            (N\_L, \ N\_WA) & $0.63$ & (N\_L, \ N\_WA) & $0.63$ & (0\_S, \ N\_L, \ N\_WA, \ N\_P) & $0.28$ \\
            \hline
            (N\_L, \ N\_WA, \ N\_P) & $0.61$ & (N\_L, \ N\_WA, \ N\_P) & $0.61$ & (1\_S, N\_L, N\_WA, N\_P) &
            $0.28$ \\ \hline
        \end{tabular}
    }
    \caption{Frequent itemsets con supporto maggiore scoperti durante l'analisi utilizzando un supporto pari a
    $20$. Con N\_WA intendiamo l'item relativo all'assenza di incidenti sul lavoro, con N\_P l'item relativo alla
    mancanza di promozioni, con N\_L l'item relativo ai dipendenti ancora in azienda, con 0\_S l'item relativo ai
    dipendenti con salario minimo, con 1\_S l'item relativo ai dipendenti con salario medio, con intensive\_H
    intendiamo i dipendenti con un quantitativo di ore mensili compreso tra $200$ e $300$ e con standard\_H
    intendiamo i dipendenti con un quantitativo di ore mensili inferiore a $200$.}
    \label{tab:interesting:freq_items}
\end{table}
Descriviamo per primi i frequent itemsets e i closed frequent itemsets, visto che sono identici. Possiamo notare
come la situazione presentata proponga in maggioranza impiegati i quali non hanno subito incidenti sul lavoro,
che non sono stati promossi e che non hanno lasciato l'azienda. Per quanto riguarda i maximal frequent itemsets
troviamo che gli impiegati con carichi di lavoro sia standard che elevati, che non hanno lasciato l'azienda, non
hanno avuto incidenti sul lavoro e che non sono stati promossi negli ultimi $5$ anni sono i più diffusi, seguiti
dagli impiegati di salario minimo e medio, non promossi e i quali non hanno avuto incidenti sul lavoro.
Portando la soglia del support a $30$, gli itemsets più diffusi sono gli stessi che sono  stati descritti per la
soglia pari a $20$, evitiamo quindi di descriverli.
% section discussion_of_the_most_interesting_frequent_patterns (end)
\section{Association rules extraction with different values of confidence }

Per estrarre le associazioni interessanti del dataset sono stati utilizzati due approcci principali per la scelta dei parametri dell'algoritmo \textit{apriori}, in modo da ottenere:
\begin{itemize}
\item \textit{Regole "generali''}, ovvero associazioni interessanti valide per un numero ampio di impiegati, ottenute fissando un alto supporto minimo, pari a $MinSupp = 20\%$, nella ricerca degli itemset frequenti.
\item \textit{Regole "specifiche''}: il supporto minimo è stato fissato considerando che uno degli obiettivi principali delle analisi contenute in questo report è capire il perchè una parte consistente dei dipendenti ha lasciato l'azienda. 
La percentuale di dipendenti che hanno lasciato l'azienda corrisponde al $24\%$ del totale, assumendo come significativa una regola che riguardi almeno il $20\%$ dei dipendenti che hanno lasciato l'azienda, risulta un supporto minimo pari a circa $MinSupp=5\%$.
\end{itemize}

L'algoritmo a priori è stato eseguito per entrambi i valori di $MinSupp$ indicati, variando la confidenza minima \textit{MinConf} per valori compresi tra $50-100\%$. In Fig. sono riportate il numero di regole ottenute, in funzione della confidenza.
Le regole cercate con l'algoritmo utilizzato hanno un solo item come parte conseguente, per facilitare l'analisi e perchè...
Per ciascuna regola estratta sono stati calcolati gli indici di \textit{confidence} e \textit{lift} in modo da valutare l'interesse oggettivo delle associazioni trovate.

\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.9\textwidth]{../images/rules/andamentonumero.pdf}
  \caption{Numero di regole estratte al variare di \textit{MinConf}, per differenti valori di \textit{MinSupp}.}
  \label{fig:rules-number}
\end{figure}



\subsection{Regole generali}
Le regole generali sono state cercate fissando a priori \textit{Minsupp=20\%} e considerando un valore di confidenza minima \textit{MinConf=50\%} ,
scelto osservando l'andamento in Fig. \ref{fig:rules_number} e sufficiente per ottenere un numero trattabile di regole. 

Per un valore di \textit{MinConf=50\%} sono state ottenute 268 regole  rappresentate in Fig. \ref{fig:rules_general}, con i rispettivi valori di Lift, Confidence e Support. Si osserva che la maggior parte delle regole ha un Lift basso, minore di 1.5.
Le regole sono state rappresentate raffigurando il valore di $Conf$ in funzione di $Lift$. Questo permette di identificare visivamente in modo immediatole regole con la stessa parte conseguente, poichè in tal caso i due indici sono proporzionali con coefficiente pari al supporto della parte conseguente.
Le regole oggettivamente interessanti, con $Lift> 2$, ben visibili nella parte destra del grafico sono riportate in Tab \ref{tab:rules-general}.
e mostrano una correlazione positiva tra un alto livello di valutazione (\textit{very good, Last Evaluation}) ed un alto grado di soddisfazione degli impiegati, a cui si accompagnano nella parte antecedente la mancanza di incidenti sul lavoro (\textit{N WA}) ed il fatto di essere rimasti in azienda.

%%Queste regole non sono particolarmente interessanti dal punto di vista dell'analisi, poichè abbastanza ovvie, e non aggiungono molto alle
%%analisi statistiche eseguite, inoltre il valore di $Lift$ non è così ampio. (è confrontabile con qualcosa? valori di riferimento?)

  
\begin{minipage}[c]{0.55\textwidth}
\begin{figure}[H]
  \centering
  \includegraphics[width=1\textwidth]{../images/rules/rules_general.pdf}
  \caption{Grafico,mettere LEGENDA PER COLORE E SIZE (Support)}
  \label{fig:rules_general}
\end{figure}
\end{minipage}
\begin{minipage}[c]{0.45\textwidth}
\begin{table}[H]
  \centering
  \scalebox{0.7}{
\input{data/rules/rules_supp20.txt}  
}
\caption{Association rules per}
\label{tab:rules_general}
\end{table}
\end{minipage}


\subsection{Regole specifiche}

Usando $MinSupp=5\%$ naturalmente il numero di associazioni trovate è notevolmente superiore, e si possono osservare in Fig. REF regole con indice di $Lift$ che arriva a valori massimi di 6-7. Per valori del supporto superiori al $15\%$ il Lift è prossimo ad 1, tranne che per le regole discusse precedentemente.

\todo[inline]{Il problema che rimane da affrontare è il seguente: Per ottenere delle regole per le persone he hanno lasciato serve un supporto basso, (che ho fissato al 5$\%$), ma questo comporta un numero elevato di regole. Come filtrarle? Sto pensando a questo, ho provato in diversi modi, ma non sono ancora giunto ad una conclusione. Al momento ci sono molti grafici, ma alcuni andranno tolti, sono ancora qua per supporto all'analisi.}



\begin{figure}[htbp]
  \centering
  \includegraphics[width=1\textwidth]{../images/rules/left_scatter.pdf}
  \caption{Grafico,mettere LEGENDA PER COLORE E SIZE (Support)}
  \label{fig:left_scatter_}
\end{figure}



\subsection{Regole per impiegati che hanno lasciato (sistemare titolo)}

\todo[inline]{SCRIVERE LA SPIEGAZIONE, tabelle successive sono poi da togliere}
Tra le regole venute fuori con $MinSupp=5$ ho estratto quelle che hanno come parte conseguente
gli impiegati che hanno lasciato, le ho poi filtrate per alta confidence, $Conf>0.90$,
ottenendo circa 80 regole, per rappresentarle e non elencarle tutte ho fatto il seguente grafico,
in cui è rappresentato il numero di regole in cui compare ciascun item nella parte antecedente.
SPIEGARE MEGLIO, DA FINIRE


\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.7\textwidth]{../images/rules/rules_left.pdf}
  \caption{Grafico,mettere LEGENDA PER COLORE E SIZE (Support)}
  \label{fig:rules_left}
\end{figure}

\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.99\textwidth]{../images/rules/left_heatmap.pdf}
  \caption{Grafico,mettere LEGENDA PER COLORE E SIZE (Support)}
  \label{fig:rules_left}
\end{figure}




\begin{table}[h!]
  \centering
  \scalebox{0.7}{
\input{data/rules/rules_left.txt}  
}
\caption{Association rules per}
\end{table}


\begin{table}[h!]
  \centering
  \scalebox{0.7}{
\input{data/rules/rules_supp5.txt}  
}
\caption{Association rules per}
\end{table}


\clearpage
\newpage
\section{Discussion of the most interesting rules }
Abbiamo inoltre rilevato delle rules che nonostante non siano frequenti sono comunque interessanti per l'analisi che stiamo portando avanti. Queste sono:
-
-
Da queste possiamo ricavare che...






\section{Use the most meaningful rules to replace missing values and evaluate the accuracy}
Nel nostro dataset non sono presenti missing values quindi non è stata necessaria la valutazione delle più significative rules e la valutazione dell'accuratezza per rimpiazzare questi.


\section{Use the most meaningful rules to predict if an employee will leave prematurely or not and evaluate the accuracy }
Date le varie association rules trovate dalle varie prove quelle descritte nella sezione \ref{sec:discussion_most_interesting_rules} sono quelle più significative per predirre se un impiegato lascerà prematuramente l'azienda oppure no. I risultati sono emersi dall'applicazione delle association rules al dataset costruito con il procedimento spiegato nella sezione introduttiva di questo capitolo.

\begin{figure}[H]
	\centering
        \includegraphics[width=0.5\textwidth]{images/rules/confusion_matrixrules_left_class_c85.pdf}
        \caption{Confusion Matrix con $confidence$ = 85}
        \label{fig:sales}
\end{figure}
Si evince che il classificatore riesce a determinare ciò che seque:
\begin{itemize}[noitemsep]
\item Diagonale TP e TN: In questa diagonale vengono descritti i dipendenti per cui si è riscontrato che il valore assegnato dal classificatore e quello reale sono uguali. Risultano quindi rispettivamente $11000$ dipendenti rimasti e $2200$ dipendenti invece che hanno lasciato l'azienda.
\item Diagonale FP e FN: A differenza della precedente diagonale in questa vengono descritti i dipendenti per cui si è riscontrato che il valore assegnato dal classificatore e quello reale sono opposti. Risultano quindi rispettivamente $1300$ dipendenti definiti dal classificatore come rimasti ma che in realtà hanno lasciato l'azienda e $810$ dipendenti classificati come dipendenti che hanno lasciato l'azienda e in realtà ancora continuano a lavorare in questa.
\end{itemize}
Da queste possiamo dedurre che $810$ dipendenti si trovano in una situazione precaria, in quanto presentano le stesse caratteristiche di un dipendente tipo che ha lasciato l'azienda. Questo probabilmente è un numero indicativo, una riduzione più o meno elevata di quello reale, in quanto il classificatore non utilizza tutte le combinazioni delle regole, che caratterizzano l'uscita prematura dell'azienda da parte del dipendente, ma quelle più significative. Questo infatti giustifica il numero elevato di dipendenti, $1300$ che il classificatore indica come ancora operativi nell'azienda ma che in realtà hanno lasciato l'azienda. Questa caratteristica è data dalla $recall$, che rappresenta una misura di completezza, come si può vedere dalla Tabella \ref{tab:confusion_matrix} ha valore $0.63$, quindi un valore sufficiente. Mentre per quanto riguarda la $precision$, che rappresenta una misura di esattezza, abbiamo un valore di $0.73$. L'accuratezza ricavata dalla confusion matrix è buona con un valore di $0.86$.
Le caratteristiche della confusion matrix sono riportate anche nella tabella sottostante:
\begin{table}[H]
        \centering
        \begin{tabular}{| c | c |} \hline
            \textbf{Dati confusion matrix} &\\ \hline
            Accuracy  & 0.86 \\ \hline
            Precision  & 0.73 \\ \hline
            Recall  & 0.63    \\ \hline
        \end{tabular}
        \label{tab:confusion_matrix}
	 \caption{Descrizione dati emersi dalla confusion matrix}
\end{table}
Il grado di esattezza e fedeltà ovvero di $precision$ è $0.73$.

